<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VIBE â€” Profile</title>
  <link rel="stylesheet" href="../styles/landing.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo"><span class="logo-icon">ðŸ”¥</span> <span class="logo-text">VIBE</span></div>
      <div class="nav-links">
        <a href="/" class="nav-link">Home</a>
        <a href="/feed" class="nav-link">Feed</a>
        <a href="/chat" class="nav-link">Chat</a>
      </div>
    </div>
  </nav>

  <main style="padding-top:100px; max-width:900px; margin:0 auto;">
    <h1>Your Profile</h1>
    <div id="profileContainer">Loading...</div>
    <section style="margin-top:24px;">
      <h3>Edit Profile</h3>
      <form id="profileForm">
        <div style="display:grid;grid-template-columns:1fr 2fr;gap:8px;align-items:center">
          <label>Display name</label>
          <input name="displayName" type="text" maxlength="50" />
          <div class="field-error" id="displayNameError" style="color:#c00;font-size:12px;display:none"></div>

          <label>Bio</label>
          <textarea name="bio" rows="3"></textarea>

          <label>Website</label>
          <input name="website" type="url" />
          <div class="field-error" id="websiteError" style="color:#c00;font-size:12px;display:none"></div>

          <label>Pronouns</label>
          <input name="pronouns" type="text" />


          <label>Location</label>
          <input name="location" type="text" />

          <label>Birthday</label>
          <input name="birthday" type="date" />

          <label>Avatar URL</label>
          <input name="avatar" type="url" />
          <div class="field-error" id="avatarError" style="color:#c00;font-size:12px;display:none"></div>
          <label>Avatar file</label>
          <input name="avatarFile" type="file" accept="image/*" />
          <div style="margin-top:8px">
            <img id="avatarPreview" src="" alt="avatar preview" style="width:80px;height:80px;border-radius:12px;object-fit:cover;display:none">
          </div>

          <label>Cover Image URL</label>
          <input name="coverImage" type="url" />
          <div class="field-error" id="coverError" style="color:#c00;font-size:12px;display:none"></div>
          <label>Cover image file</label>
          <input name="coverFile" type="file" accept="image/*" />
          <div style="margin-top:8px">
            <img id="coverPreview" src="" alt="cover preview" style="width:300px;height:100px;border-radius:6px;object-fit:cover;display:none">
          </div>

          <label>Theme</label>
          <select name="theme">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="system">System</option>
          </select>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center">
          <button id="saveProfile" type="submit">Save</button>
          <div id="spinner" style="display:none;margin-left:8px">Savingâ€¦</div>
          <div id="profileMsg" aria-live="polite"></div>
          <div id="profileToast" role="status" style="display:none;margin-left:12px;padding:6px 10px;border-radius:6px;background:#0f172a;color:#fff">Saved</div>
        </div>
      </form>
    </section>
  </main>

  <script src="../scripts/common.js"></script>
  <script src="../scripts/profile.js"></script>
  <script>
    async function loadProfile() {
      const token = localStorage.getItem('token');
      const container = document.getElementById('profileContainer');
      if (!token) {
        container.innerHTML = '<p>Please log in to view your profile.</p>';
        return;
      }

      try {
        const res = await fetch('/api/users/me', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        if (data.success && data.user) {
          const u = data.user;
          container.innerHTML = `
            <div style="display:flex;gap:1rem;align-items:center">
              <img src="${u.profile.avatar}" alt="avatar" style="width:80px;height:80px;border-radius:12px;object-fit:cover">
              <div>
                <h2>${u.username} ${u.profile.isVerified ? 'âœ“' : ''}</h2>
                <div>${u.profile.displayName}</div>
                <div style="color:#bbb">${u.profile.bio || ''}</div>
              </div>
            </div>
          `;
        } else {
          container.innerHTML = '<p>Unable to load profile.</p>';
        }
      } catch (e) {
        container.innerHTML = '<p>Error loading profile.</p>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadProfile);
  </script>
</body>
</html>
